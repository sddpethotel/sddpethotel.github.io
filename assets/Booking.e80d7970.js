import{G as T}from"./GeneralReservation.14b5af34.js";import{a0 as P,a as C,_ as M,o as n,c as d,f as m,w as h,ab as y,e as S,a7 as v,ai as b,F as g,aa as $,r as f,k as B,j as N}from"./index.dda7049c.js";import{u as G}from"./pet-store.04b64423.js";import{R as E}from"./RoomReservationSummary.e44437f3.js";import{G as Q}from"./GeneralServiceSelector.3b8997cd.js";import{g as I,p as z}from"./datafetcher.ff370c84.js";import{Q as R}from"./QBtn.9996c0f7.js";import{Q as q,a as F,D as L}from"./DashboardToolbar.41fc4a83.js";import{d as O}from"./date.528ab822.js";import{U as V}from"./URLStrings.70d3a492.js";import"./QBar.670e86f8.js";import"./use-dark.94e400c1.js";import"./QCardSection.71e88b5c.js";import"./QPopupProxy.e2c68b68.js";import"./use-cache.b0833c75.js";import"./use-key-composition.603e6653.js";import"./uid.42677368.js";import"./focus-manager.05708ea9.js";import"./format.2bc25e5f.js";import"./QDialog.af084a99.js";import"./use-timeout.85ee0991.js";import"./scroll.bf116c29.js";import"./QMenu.cb6c7205.js";import"./selection.ebc1c08a.js";import"./QInput.bba9a822.js";import"./QScrollArea.6a0d07f8.js";import"./touch.5b285bde.js";import"./ClosePopup.84ffc425.js";import"./PetSelector.ac3a0fdd.js";import"./QImg.8735273d.js";import"./SponsorNameCombo.68f1c13c.js";import"./QItem.c47cf5af.js";import"./QSeparator.9d997a39.js";import"./QList.dfd471e7.js";import"./QChip.80c487cc.js";import"./QTabs.dd243adb.js";import"./rtl.b51694b1.js";import"./QTabPanels.dfd89b55.js";import"./QSpinnerOrbit.57ba873c.js";import"./QInnerLoading.7c6a5134.js";import"./SummaryAction.565edeee.js";import"./axios.13cf03e6.js";const{formatDate:k}=O,U=G(),{selected_squares:Y,room_reservation_data:j}=P(U),A=C({name:"DateSelector",setup(){return{selected_squares:Y,room_reservation_data:j}},props:["rooms","roomdatas","existing_reservations","dateStart","weeks_diff"],emits:["decrement_week","increment_week"],computed:{fdateStart(){const e=new Date(this.dateStart);return e.setDate(this.dateStart.getDate()+this.weeks_diff*7),k(e,"MMMM D")},dateEnd(){const e=new Date(this.dateStart);return e.setDate(this.dateStart.getDate()+6+this.weeks_diff*7),k(e,"MMMM D")}},methods:{push_square(e,t){const[r,a]=e.split("__"),_=parseInt(a)+this.weeks_diff*7,u=`${r}__${_}`,s=this.selected_squares.indexOf(u);if(this.reservation_index(t,parseInt(a)+1)!==-1)return;if(s===-1){for(const i of this.selected_squares){const[c,l]=i.split("__");if(l==`${parseInt(a)+this.weeks_diff*7}`)return}this.selected_squares.push(`${r}__${parseInt(a)+this.weeks_diff*7}`),this.selected_squares.sort((i,c)=>{const l=parseInt(this.separator(i)[1]),p=parseInt(this.separator(c)[1]);return l-p})}else this.selected_squares.splice(s,1);let o=[];this.selected_squares.forEach(i=>{const[c,l]=this.separator(i),p=new Date(this.dateStart);p.setDate(this.dateStart.getDate()+parseInt(l)-1),o.push({roomId:this.roomdatas[parseInt(c)-1].roomId,date:p})}),this.room_reservation_data=o},separator(e){return e.split("__")},days_from_now(e){const t=new Date(this.dateStart);return t.setDate(this.dateStart.getDate()+e+this.weeks_diff*7),k(t,"D")},reservation_index(e,t){return this.existing_reservations==null?-1:this.existing_reservations.findIndex(r=>{const a=new Date;a.setDate(a.getDate()+(t-2)+this.weeks_diff*7);const _=new Date(r.room_start_date),u=`${a.getDate()}-${a.getMonth()+1}-${a.getFullYear()}`,s=`${_.getDate()}-${_.getMonth()+1}-${_.getFullYear()}`;return r.roomId==this.roomdatas[e-2].roomId&&u===s})},grid_ele_class(e,t){let r="";return this.selected_squares.includes(`${t-1}__${e-1+this.weeks_diff*7}`)?r+="bg-green-5 rounded-10 shadow-3":this.reservation_index(t,e)!==-1?r+="bg-red-2":r="bg-grey-3",r}},data(){return{days:7}}}),H={class:"text-bold"},J={key:0},K={key:1,class:"bg-green-2 text-center"},W={key:2,class:"bg-purple-2 cursor-help text-sideways text-center room-label"},X=["onClick","data-room","data-day"];function Z(e,t,r,a,_,u){return n(),d("div",{style:b({display:"grid","grid-template-columns":`20px repeat(${e.days}, 1fr)`,"grid-template-rows":`50px 20px repeat(${e.rooms}, 100px)`,"grid-column-gap":"5px","grid-row-gap":"5px"})},[m(F,{style:b({"grid-column-start":`span ${e.days+1}`}),class:"bg-grey-4"},{default:h(()=>[m(R,{name:"keyboard_double_arrow_left",class:y(e.weeks_diff!=0?"cursor-pointer":"inactive"),size:"40px",onClick:t[0]||(t[0]=s=>e.$emit("decrement_week"))},null,8,["class"]),m(q),S("div",H,v(`${e.fdateStart} -  ${e.dateEnd}`),1),m(q),m(R,{name:"keyboard_double_arrow_right",class:"cursor-pointer",size:"40px",onClick:t[1]||(t[1]=s=>e.$emit("increment_week"))})]),_:1},8,["style"]),(n(!0),d(g,null,$(e.rooms+1,s=>(n(),d(g,{key:s},[(n(!0),d(g,null,$(e.days+1,o=>{var i;return n(),d(g,{key:o},[o==1&&s==1?(n(),d("div",J)):s==1&&o>1?(n(),d("div",K,v(e.days_from_now(o-2)),1)):o==1&&s>1?(n(),d("div",W,v(e.roomdatas?(i=e.roomdatas[s-2])==null?void 0:i.roomLabel:""),1)):(n(),d("div",{key:3,class:y(["cursor-pointer",e.grid_ele_class(o,s)]),onClick:c=>e.push_square(`${s-1}__${o-1}`,s),"data-room":s-1,"data-day":o-1},null,10,X))],64)}),128))],64))),128))],4)}var x=M(A,[["render",Z],["__scopeId","data-v-076f0258"]]);const w=G(),{booking_summary:ee,pets:te,getSelectedPetId:se,getSelectedPetData:re,selected_squares:oe,room_reservation_data:ae}=P(w),ie=C({name:"BookingSummary",components:{GeneralReservation:T,RoomReservationSummary:E,GeneralServiceSelector:Q,RoomSelector:x,DashboardToolbar:L},setup(){return{selected_squares:oe,booking_summary:ee,pets:te,store:w,getSelectedPetId:se,getSelectedPetData:re,room_reservation_data:ae}},methods:{set_category_name(e,t){this.categoryName=e+(t?`: ${t}`:"")},reset(){this.selected_squares.length=0},decrement_week(){this.weeks_diff!=0&&(this.weeks_diff-=1,this.fetch_reservations())},increment_week(){this.weeks_diff+=1,this.fetch_reservations()},fetch_reservations(){var t;if(((t=this.getSelectedPetData)==null?void 0:t.speciesId)==null||this.getSelectedPetData.breedId==null)return;const e=new Date(this.dateStart);e.setDate(this.dateStart.getDate()+this.weeks_diff*7),I(`api/v1/reservation/room/scheduled/${e.getTime()}/mini/${this.getSelectedPetData.speciesId}/${this.getSelectedPetData.breedId}`,this.existing_reservations)},fetch_rooms(){var e,t,r;((e=this.getSelectedPetData)==null?void 0:e.breedId)!=null&&I(`api/v1/room/breed/${(t=this.getSelectedPetData)==null?void 0:t.breedId}/species/${(r=this.getSelectedPetData)==null?void 0:r.speciesId}`,this.roomdatas,()=>{this.rooms=this.roomdatas.length,this.fetch_reservations()})},submitReservation(){const e=w.getSelectedPetId;if(e==null)return;const r={service_data:{sponsor:this.booking_summary.sponsor,petId:e,serviceId:this.booking_summary.serviceId,reservationRemarks:this.booking_summary.remarks},roomDates:this.room_reservation_data};this.loading=!0,z(V.POST_RSRV_ROOM_CLIENT_SIDE,r,null,()=>{this.loading=!1,this.reset(),this.booking_confirmed=!0},!1)}},computed:{total_price(){return this.booking_summary.price==null?0:this.selected_squares.length*this.booking_summary.price}},watch:{getSelectedPetId(){this.reset(),this.fetch_rooms()}},data(){const e=[],s=new Date;return{categoryName:"",weeks_diff:0,existing_reservations:[],dateStart:s,rooms:1,roomdatas:e,loading:!1,booking_confirmed:!1,selected_room:null}}}),ne={class:"row justify-center"},de={class:"clamped-width-wide"};function me(e,t,r,a,_,u){const s=f("DashboardToolbar"),o=f("RoomSelector"),i=f("GeneralServiceSelector"),c=f("RoomReservationSummary"),l=f("GeneralReservation");return n(),d(g,null,[m(s,{title:"Book Room"}),m(l,{onSubmitReservation:e.submitReservation,booking_confirmed:e.booking_confirmed,show_room_selector:!0},{roomSelector:h(()=>[e.getSelectedPetId?(n(),B(o,{key:0,roomdatas:e.roomdatas,rooms:e.rooms,"date-start":e.dateStart,weeks_diff:e.weeks_diff,existing_reservations:e.existing_reservations,onIncrement_week:e.increment_week,onDecrement_week:e.decrement_week},null,8,["roomdatas","rooms","date-start","weeks_diff","existing_reservations","onIncrement_week","onDecrement_week"])):N("",!0)]),serviceSelector:h(()=>[m(i,{"service-type-name":"Room",onSet_category_name:e.set_category_name},null,8,["onSet_category_name"])]),reservationSummary:h(()=>{var p,D;return[S("div",ne,[S("div",de,[m(c,{onSubmitReservation:e.submitReservation,loading:e.loading,booking_confirmed:e.booking_confirmed,pet_name:(p=e.store.getSelectedPetData)==null?void 0:p.name,pet_profilepic:(D=e.store.getSelectedPetData)==null?void 0:D.profilepic,sponsor:e.booking_summary.sponsor,reservation_remarks:e.booking_summary.remarks,room_reservations:e.room_reservation_data,price:e.booking_summary.price,total_price:e.total_price,is_room_reservation:!0,is_booking:!0,"category-name":e.categoryName},null,8,["onSubmitReservation","loading","booking_confirmed","pet_name","pet_profilepic","sponsor","reservation_remarks","room_reservations","price","total_price","category-name"])])])]}),_:1},8,["onSubmitReservation","booking_confirmed"])],64)}var Ze=M(ie,[["render",me]]);export{Ze as default};
